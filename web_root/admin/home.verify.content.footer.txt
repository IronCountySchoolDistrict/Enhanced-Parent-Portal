<style>
    #parent-verify-link {
        font-weight: bold;
        color: #FF0000;
    }
</style>

<script type="text/template" id="parent-verify-template">
    <a href="students/home.html?selectstudent=U_Students_Extension.parent_verify=1" id="parent-verify-link">
        Parent Verify
    </a>
</script>

<script type="text/template" id="parent-loading-template">
    <span>Loading Parent Verify...</span>
</script>

<script>
    $j(function () {
        var loadingTemplate = $j($j('#parent-loading-template').html());
        var loadingSelector = $j('[href^="/admin/storedselections"]');
        loadingTemplate.insertAfter(loadingSelector);
        $j.get('/admin/has-verify.html', function (verifyLink) {
            var insertSelector = $j('[href^="/admin/storedselections"]');

            if (verifyLink.hasVerify !== '0') {
                var count = 0;
                $j.get('/admin/verify-count.html', function (verifyCount) {
                    if (verifyCount.count) {
                        count = verifyCount.count;
                    }

                    var parentVerifyLink = $j($j('#parent-verify-template').html());
                    parentVerifyLink.insertAfter(insertSelector);

                    var parentVerifyText = parentVerifyLink.text();
                    parentVerifyLink.text(parentVerifyText + ' (' + count + ')');

                    loadingTemplate.remove();

                    $j('#parent-verify-link').on('click', function(event) {
                        event.preventDefault();
                        // Make sure the student info verify page is shown when parent verify link is clicked
                        $j.get('/admin/students/studentinfochange.html?frn=~(studentfrn)', function(getEvent) {
                            window.location.href = '/admin/students/home.html?selectstudent=U_Students_Extension.parent_verify=1';
                        });
                    })
                }, 'json');
            } else {
                loadingTemplate.remove();

                $j('<span>Parent Verify (0)</span>').insertAfter(insertSelector);
            }
        }, 'json');
    });
</script>