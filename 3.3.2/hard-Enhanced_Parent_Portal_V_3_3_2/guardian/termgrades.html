<!DOCTYPE html>
<html>
<head>
~[if#1.pref.historicalgrades~(curschoolid)=1]~[redirect:/guardian/home_not_available.html] 
[else#1]
	~[if#1a.isguardianAndSSOEnabled]
	~[if#2.~([Students]allowwebaccess)=0]
	~[redirect:/guardian/home_not_available.html]
	[/if#2]
	[/if#1a]
[/if#1]
<title>~[text:psx.html.guardian.termgrades.grade_history_]</title>
~[wc:guardian_header]
  <h1>Grade History</h1>
  <!-- title -->

<div id="gradesHistory" class="box-round group">
~[if#1.prefschool.sgshowpa=1]
<!-- title -->
[else#1]

<ul class="tabs" id="nav-secondary">        
	<li class="selected">
      	<a href="#">Grade History</a>
	</li>
     	<li>
		<a href="/guardian/termgradesstd.html?histyearid=~[gpv:histyearid]">Standards Grade History</a>
      </li>
</ul>


[/if#1]

<!-- start student content -->

~[f.variable_create;name=histyearid;type=INT;when=NEVER]
~[if.~[gpv:histyearid]=]
~[f.variable_set;name=histyearid;value=~(curyearid)]
[else]
~[f.variable_set;name=histyearid;value=~[gpv:histyearid]]
[/if]

<style type="text/css">
<!--
.coursecol {border-style:solid;border-width:2px;}
-->
</style>
<!-- start of tabs -->
		
		<!-- BEGIN Dynamic Year tabs -->
<ul class="tabs" id="nav-secondary"> 
~[tlist_sql;select distinct 
CASE WHEN ~(v.histyearid) = substr(termid,1,2) THEN 'class="selected"' ELSE '' END class1,
CASE WHEN ~(v.histyearid) = substr(termid,1,2) THEN '<a href="#">'||to_char(substr(termid,1,2)+1990)||'-'||to_char(substr(termid,1,2)+1991)||'</a>' 
	ELSE '<a href="termgrades.html?histyearid='||substr(termid,1,2)||'">'||to_char(substr(termid,1,2)+1990)||'-'||to_char(substr(termid,1,2)+1991)||'</a>' END class2,
substr(termid,1,2) yearid, '~(v.histyearid)' yeartest from storedgrades where studentid=~(curstudid) order by to_char(substr(termid,1,2)+1990)||'-'||to_char(substr(termid,1,2)+1991)]
	
	<li ~(class1)>
      	~(class2)
	</li>
[/tlist_sql]
</ul>
        <!-- END Dynamic Year tabs -->

<!-- end of tabs -->

<!-- start of content and bounding box -->

~[f.variable_create;name=termstart;type=INT;when=NEVER]
~[f.variable_set;name=termstart;value=~(v.histyearid)00]
~[f.variable_create;name=termend;type=INT;when=NEVER]
~[f.variable_set;name=termend;value=~(v.histyearid)99]
~[f.table_info;table=Storedgrades;dothisfor=all;field=storecode;fn=sel;*studentid=~(curstudid);condfield1=termid;condfieldtype1=INT;comparator1=.gte.;condval1=~(v.termstart);condfield2=termid;condfieldtype2=INT;comparator2=.lte.;condval2=~(v.termend);]
~[f.order_by;table=Storedgrades;object1=termid;type1=INT;direction1=.gt.]
~[f.variable_create;name=sql;type=TEXT;when=NEVER]
~[f.variable_create;name=colgroup;type=TEXT;when=NEVER]
~[f.variable_create;name=Header;type=TEXT;when=NEVER]
~[f.variable_create;name=Header2;type=TEXT;when=NEVER]
~[f.variable_create;name=storecodelist;type=TEXT;when=never]
~[f.variable_set;name=storecodelist;value=~(f.unique_val;table=storedgrades;dothisfor=currentsel;field=storecode;fieldtype=TEXT;delim=CMA);]
~[f.array;name=list;fn=create;value=~(v.storecodelist);delim=,;elem_type=TEXT;]
~[duplicate;~[f.array;name=list;fn=count];zz;count;counterstart=1]
~[f.variable_add;name=colgroup;value=<colgroup span="4" class="coursecol"></colgroup>]
~[f.variable_add;name=Header;value=<td align="center" class="bold" colspan="4">~[f.array;name=list;fn=value;index=zz]</td>]
~[f.variable_add;name=Header2;value=<td align="center" class="bold">Grade</td><td align="center" class="bold">%</td><td align="center" class="bold">Cit</td><td align="center" class="bold">Hrs</td>]
~[f.variable_add;name=sql;value='<td align="center">'||max(case when storecode='~[f.array;name=list;fn=value;index=zz]' then Grade else '&nbsp'||chr(59) end)||'</td>'||'<td align="center">'||max(case when storecode='~[f.array;name=list;fn=value;index=zz]' then '<a href="tgscores.html?frn=031'||dcid||'&histyearid=~[gpv:histyearid]&fg='||storecode||'">'||percent||'</a>' else '&nbsp'||chr(59) end)||'</td>'||'<td align="center">'||max(case when storecode='~[f.array;name=list;fn=value;index=zz]' then behavior else '&nbsp'||chr(59) end)||'</td>'||'<td align="center">'||max(case when storecode='~[f.array;name=list;fn=value;index=zz]' then to_char(earnedcrhrs) else '&nbsp'||chr(59) end)||'</td>'||]
[/duplicate]
			<table border="2" cellspacing="0" cellpadding="3" style="border-collapse: collapse">
			<colgroup></colgroup>
			~(v.colgroup)
			  <tr>
				<td rowspan="2" class="bold">Course Name</td>
				~(v.header)
			  </tr>
			  <tr>
				~(v.header2)
			  </tr>
~[tlist_sql;
SELECT course_name, ~(v.sql)'' grades
from storedgrades where studentid=~(curstudid) and termid between ~(v.histyearid)00 and ~(v.histyearid)99 group by course_name order by upper(course_name);alternatecolor]
			  <tr bgcolor="#edf3fe">
				<td>~(course_name)~[guv:test]</td>
				~(grades)
			  </tr>
			  [/tlist_sql]
			</table>
  </div>
</div>


</div>
<!-- end parent content -->

<!-- end of title and student content -->
</div>
<input id="activeNav" type="hidden" value="#btn-gradesHistory"/>
<input id="activePageVersion" type="hidden" value="3.3.1"/>
~[wc:guardian_footer]
</body></head>
